@startuml
'https://plantuml.com/sequence-diagram

title US009 - As Product Owner, I want to create a user story and add it to the Product Backlog

autoactivate on
autonumber


participant ": CreateUserStoryRoute" as System
participant ": CreateUserStoryController" as Ctrl
participant ": CreateUserStoryService" as appService
participant ": IUserStoryFactory" as factory
participant ": UserStoryDTO" as usDto
participant ": IUserStoryIDFactory" as IusID
participant " userStoryID : UserStoryID" as usID
participant "newUserStory : \n UserStory" as us
participant ": IUsPriorityFactory" as IusPrio
participant "usPriority : UsPriority" as usPrio
participant ": IUserStoryRepo " as usStore
participant ": UserStoryMapper" as usMapper
participant "outputUsDto : \n UserStoryDto" as outDto



[o-> System: POST/userStories(json)
System -> Ctrl: createUserStory(json)
note right
Change from json to dto hidden to simplify diagram
end note
Ctrl -> appService: createAndSaveUserStory(userStoryDTO)
appService -> factory:  createUserStory(userStoryDTO)
factory -> usDto: projectID = getProjectID()
deactivate
factory -> usDto: title = getTitle()
deactivate
factory -> IusID: create(projectID, title)
 IusID-> usID **: create()
 IusID--> factory : userStoryID

factory-> usDto: priority = getPriority()
deactivate
factory -> IusPrio: create(priority)
 IusPrio-> usPrio **: create()
 IusPrio--> factory : usPriority
 note over us: other v.o.'s creation  are hidden to simplify the diagram
factory-> usDto: description = getDescription()
 deactivate
 factory-> usDto: timeEstimate = getTimeEstimate()
  deactivate


factory -> us **: create(userStoryID, usPriority, usDescription, usTimeEstimate)
factory --> appService: newUserStory

appService-> usStore: save(newUserStory)
usStore-> usStore: existsByUserStoryId\n(UserStoryID)
deactivate
usStore-> usStore: add(newUserStory)
deactivate
usStore --> appService : true
appService-> usMapper : toDto(newUserStory)
usMapper-> outDto **:create()
usMapper --> appService: outputUsDto
appService --> Ctrl: outputUsDto
Ctrl --> System: outputUsJson
note right
Change from json to dto hidden to simplify diagram
end note
[<--System : Informs that user story was created

@enduml

